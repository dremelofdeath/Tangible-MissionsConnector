if(!Object.keys){Object.keys=function(c){if(c!==Object(c)){throw new TypeError("Object.keys called on non-object")}var a=[],b;for(b in c){if(Object.prototype.hasOwnProperty.call(c,b)){a.push(b)}}return a}}function $_GET(b,c){var a=new RegExp(b+"=([^&]*)","i").exec(c||window.location.search);return a&&unescape(a[1])||undefined}var CMC={loggedInUser:false,isFirstRun:false,accessToken:false,me:false,friends:false,profiledata:null,tripdata:{},isreceiver:false,profileexists:false,profileedit:false,tripedit:false,requestsOutstanding:0,tripuserid:false,dialogsOpen:0,currentlyShownUserProfileID:null,version:"2.0 Build A9",ignorableFormFields:null,linkProfileID:null,linkTripID:null,_searchLockKeyExpected:null,_lastSearchLockKeyGenerated:0,isSearchLocked:false,searchPageCache:[],currentDisplayedSearchPage:0,searchPageImageClearJobQueue:[],SearchState:{},StartupConfig:{},BackendTranslation:{Profile:{"profile-medical-skills":"medskills","profile-nonmedical-skills":"otherskills","profile-spiritual-skills":"spiritserv","profile-religion":"relg","profile-duration":"dur","profile-state":"state","profile-city":"city","profile-zipcode":"zip","profile-country":"mycountry","profile-region":"region","profile-country-served":"country","profile-phone":"phone","profile-email":"email","profile-experience":"misexp"},OrganizerProfile:{"profile-org-name":"name","profile-org-website":"url","profile-org-about":"about","profile-org-offer":"medfacil","profile-org-offern":"nonmedfacil","profile-org-medical":"medskills","profile-org-nonmedical":"otherskills","profile-org-spiritual":"spiritserv","profile-org-religion":"relg","profile-org-duration":"dur","profile-org-state":"state","profile-org-city":"city","profile-org-zipcode":"zip","profile-org-country":"mycountry","profile-org-region":"region","profile-org-countryserved":"country","profile-org-phone":"phone","profile-org-email":"email","profile-org-experience":"misexp"},TripProfile:{"profile-trip-name":"name","profile-trip-website":"url","profile-trip-about":"about","profile-trip-religion":"relg","profile-trip-duration":"dur","profile-trip-city":"city","profile-trip-zipcode":"zip","profile-trip-country":"mycountry","profile-trip-languages":"languages","profile-trip-phone":"phone","profile-trip-email":"email","profile-trip-stage":"stage","profile-trip-depart":"depart","profile-trip-return":"return","profile-trip-number":"numpeople","profile-trip-acco":"acco","profile-trip-medical-skills":"medskills","profile-trip-nonmedical-skills":"otherskills","profile-trip-spiritual-skills":"spiritserv"}},performStartupActions:function(){},page:function(b,a){$(b).hide("drop",{direction:"left"},250,function(){$(a).show("drop",{direction:"right"},250,null)})},closeAllDialogs:function(a){$(".ui-dialog:visible").each(function(){$(this).children(".ui-dialog-content").each(function(){if(this!=a){$(this).dialog("close")}})})},dialogOpen:function(a){this.dialogsOpen++;this.closeAllDialogs(a);if($.support.opacity&&this.dialogsOpen==1){$("#tabs, #cmc-footer").fadeTo("fast",0.5)}},dialogClose:function(a){if($.support.opacity&&this.dialogsOpen==1){$("#tabs, #cmc-footer").fadeTo("fast",1)}if(this.dialogsOpen<=0){}else{this.dialogsOpen--}},showAjaxSpinner:function(){$("#ajax-spinner").show()},hideAjaxSpinner:function(){$("#ajax-spinner").hide()},ajaxNotifyStart:function(){if(this.requestsOutstanding==0){this.showAjaxSpinner()}this.requestsOutstanding++},ajaxNotifyComplete:function(){if(this.requestsOutstanding>0){this.requestsOutstanding--;if(this.requestsOutstanding==0){this.hideAjaxSpinner()}}else{if(this.requestsOutstanding==0){}}},applyTranslationMap:function(c,a){var b={};if(c){if(a){for(var d in c){if(c.hasOwnProperty(d)){if(a.hasOwnProperty(d)){b[a[d]]=c[d]}else{}}}}else{}}else{}return b},processURL:function(){var b=$_GET("tab");var a=null;switch(b){case"profile":this.linkProfileID=$_GET("id");a=1;break;case"trips":this.linkTripID=$_GET("id");a=2;break;case"search":a=3;break;case"network":a=4;break;case"invite":a=5;break;default:if(b&&typeof +b=="number"){a=+b}}if(a){$("#tabs").tabs("select",a)}},recalculateTextareaLimit:function(d,e,c,b){var a=$(d).val().length;c=c||300;b=b||" characters left";$(e).html((c-a)+b)},recalculateProblemMessageLimit:function(a){this.recalculateTextareaLimit("#report-problem-message","#report-problem-characters-left",a);$("#report-problem-characters-left").fadeIn()},handleGenericUnexpectedCallbackError:function(c,d,b,a){if(a==undefined){a=""}else{if(a.length>0&&a.charAt(0)!=" "){a=" "+a}}},handleGenericServerError:function(a,c,b){},showTabLoading:function(a){var b="#"+a+"-tab-loading";$(b).attr("pendingShow","true");$("#"+a+"-tab").children("div :visible").not(".tab-loading-screen").stop(true,true).fadeOut(100,function(){if($(b).attr("pendingShow")=="true"){$(b).fadeIn(50)}})},hideTabLoading:function(a,c){var b="#"+a+"-tab-loading";$(b).attr("pendingShow","false");$(b).stop(true,true).fadeOut(50,$.proxy(function(){if(c){c()}$(b).hide()},this))},handleGetProfileCallbackSave:function(a){if(a.isreceiver==0){this.isreceiver=0}else{this.isreceiver=1}this.profiledata=a},handleGetProfileCallbackSaveAndShow:function(a){this.handleGetProfileCallbackSave(a);this.showProfile(a)},getProfile:function(b,a,c){c=c||this.handleGetProfileCallbackSave;if(typeof a=="function"){c=a;a=false}if(a){this.showTabLoading("profile")}if(b){this.ajaxNotifyStart();$.ajax({type:"POST",url:"api/profile.php",data:{fbid:b},dataType:"json",context:{invokeData:{callback:c,},cmc:this},success:this.onGetProfileDataSuccess,error:this.onGetProfileDataError})}else{}},onGetProfileDataSuccess:function(b,c,a){if(b.has_error!==undefined&&b.has_error!==null){if(b.has_error){if(b.exists==0){this.cmc.ajaxNotifyComplete();this.cmc.hideTabLoading("profile",$.proxy(function(){this.showProfile(null)},this.cmc))}else{this.cmc.hideTabLoading("profile",$.proxy(function(){this.handleGetProfileDataSuccessHasError(b)},this.cmc))}}else{if(this.invokeData.callback){this.cmc.hideTabLoading("profile",$.proxy(function(){this.invokeData.callback.call(this.cmc,b)},this));this.cmc.ajaxNotifyComplete()}}}else{this.cmc.handleGenericUnexpectedCallbackError(b,c,a,"profile data")}},updateProfileControls:function(a){if(a!=CMC.me.id){$("#profile-controls-back-to-my-profile").show();$("#profile-controls-edit").hide();$("#profile-controls-create-trip").hide()}else{$("#profile-controls-back-to-my-profile").hide();$("#profile-controls-edit").show();$("#profile-controls-create-trip").show()}},hideIntermediateNewProfileCreationSteps:function(){$("#no-profile").hide();$("#make-volunteer").fadeOut();$("#make-organizer").fadeOut();$("#make-profile").hide()},showCreateNewProfileUI:function(){this.hideIntermediateNewProfileCreationSteps();$("#no-profile").fadeIn();$("#no-profile-trip").fadeIn();this.isFirstRun=true},showProfile:function(f){if(f===undefined){}else{if(f==null){this.showCreateNewProfileUI();this.currentlyShownUserProfileID=null}else{var h="#profilecontent";var c=function(i){$("#profile-name-link").attr("href",i);$("#profile-picture-link").attr("href",i)};this.hideIntermediateNewProfileCreationSteps();this.currentlyShownUserProfileID=f.id;this.updateProfileControls(f.id);$("#profile-name").html(f.name?f.name:"");if(!f.link){this.ajaxNotifyStart();FB.api(f.id,$.proxy(function(i){c(i.link);this.ajaxNotifyComplete()},this))}else{c(f.link)}$("img.profile-picture").attr("src","https://graph.facebook.com/"+f.id+"/picture?type=large");$("#profile-section-about-me-content").html(f.about?f.about:"");if(f.MedicalSkills==undefined){$("#profile-medskills").html("")}else{if(f.MedicalSkills.length>0){var g="<ul>";for(var e in f.MedicalSkills){g+="<li> "+f.MedicalSkills[e]+"</li>"}g+="</ul>";$("#profile-medskills").html(f.MedicalSkills?g:"")}else{$("#profile-medskills").html("")}}if(f.Non_MedicalSkills==undefined){$("#profile-nonmedskills").html("")}else{if(f.Non_MedicalSkills.length>0){var g="<ul>";for(var e in f.Non_MedicalSkills){g+="<li> "+f.Non_MedicalSkills[e]+"</li>"}g+="</ul>";$("#profile-nonmedskills").html(f.Non_MedicalSkills?g:"")}else{$("#profile-nonmedskills").html("")}}if(f.email){$("span#profile-email").html(f.email);$("#profile-email-display").show()}else{$("#profile-email-display").hide();$("span#profile-email").html("")}if(f.AgencyWebsite){$("span#profile-website").html(f.AgencyWebsite);$("#profile-website").show()}else{$("#profile-website").hide();$("span#profile-website").html("")}if(f.phone){$("span#profile-phone").html(f.phone);$("#profile-phone-display").show()}else{$("#profile-phone-display").hide();$("span#profile-phone").html("")}if(f.country){$("span#profile-country").html(f.country);$("#profile-country-display").show()}else{$("#profile-country-display").hide();$("span#profile-country").html("")}if(f.zip){if(f.city){if(f.States){$("span#profile-zip").html(f.zip+" ("+f.city+", "+f.States.shortname+")")}else{$("span#profile-zip").html(f.zip+" ("+f.city+")")}}else{if(f.States){$("span#profile-zip").html(f.zip+" ("+f.States.State+")")}else{$("span#profile-zip").html(f.zip)}}$("#profile-zip-display").show()}else{$("#profile-zip-display").hide();$("span#profile-zip").html("")}if(f.Durations&&f.Durations.PreferredDurationofMissionTrips){var d="";for(var e in f.Durations.PreferredDurationofMissionTrips){d+=f.Durations.PreferredDurationofMissionTrips[e]+", "}d=d.slice(0,d.length-2);$("span#profile-dur").html(d);$("#profile-dur-display").show()}else{$("#profile-dur-display").hide();$("span#profile-dur").html("")}if(f.GeographicAreasofInterest&&f.GeographicAreasofInterest.Countries){var a="";for(var e in f.GeographicAreasofInterest.Countries){a+=f.GeographicAreasofInterest.Countries[e]+", "}a=a.slice(0,a.length-2);$("span#profile-countries").html(a);$("#profile-countries-display").show()}else{$("#profile-countries-display").hide();$("span#profile-countries").html("")}if(f.trips==undefined||f.trips.length<=0){$("div#profile-trips-list-section").hide()}else{var b=this.buildTripList(f,true,f.id==this.me.id,false,false,f.id==this.me.id);b.attr("id","profile-trip-list");$("ul#profile-trip-list").remove();$("div#profile-trips-list-section").append(b).show()}$("#show-profile").fadeIn()}}},onGetProfileDataError:function(a,c,b){this.cmc.ajaxNotifyComplete();this.cmc.handleGenericServerError(a,c,b)},handleGetProfileDataSuccessHasError:function(a){this.ajaxNotifyComplete();if(a.err_msg!==undefined){if(a.err_msg!=""){}else{}}else{}},refreshUserProfile:function(a){if(this.me.id==this.currentlyShownUserProfileID){this.getProfile(this.me.id,false,this.handleGetProfileCallbackSaveAndShow)}else{this.getProfile(this.me.id,false,this.handleGetProfileCallbackSave)}},getFutureTrips:function(){$.ajax({type:"POST",url:"api/searchtrips.php",data:{fbid:CMC.me.id?CMC.me.id:""},dataType:"json",context:this,success:this.onGetTripsDataSuccess,error:this.onGetTripsDataError})},onGetTripsDataSuccess:function(b,c,a){if(b.has_error!==undefined&&b.has_error!==null){if(b.has_error){this.handleGetTripsDataSuccessHasError(b)}else{this.updateFutureTrips(b)}}else{this.handleGenericUnexpectedCallbackError(b,c,a,"future trips data")}},onGetTripsDataError:function(a,c,b){this.handleGenericServerError(a,c,b)},buildTripListEx:function(b,e){var d=$("<ul></ul>",{"class":"trip-list"});for(var g in b.trips){var i=$("<li></li>",{"class":"trip-list-item"});var h=$("<span></span>",{"class":"trip-item-name",text:b.trips[g].tripname});i.append(h);for(var f in e){var a=true;if(e[f].hasOwnProperty("test")){a=e[f].test(b.trips[g])}if(a){var c=$("<div></div>",{"class":"trip-item-control",text:e[f]["text"],tripid:b.trips[g].id}).button({text:true,icons:{primary:e[f]["icon"]}}).click(e[f]["action"]);i.append(c)}}d.append(i)}return d},buildTripList:function(g,c,e,b,h,a){var f=[];if(a){f.push({text:"Leave Trip",icon:"ui-icon-close",action:function(){CMC.leaveTrip($(this).attr("tripid"))}})}if(c){f.push({text:"More Info",icon:"ui-icon-info",action:function(){CMC.getTripProfile($(this).attr("tripid"))}})}if(e){f.push({text:"Edit Trip",icon:"ui-icon-pencil",action:function(){CMC.editTripProfile($(this).attr("tripid"))},test:function(i){return i&&i.isadmin&&i.isadmin!=0}})}if(b){f.push({text:"Join Trip",icon:"ui-icon-check",action:function(){CMC.joinTrip($(this).attr("tripid"))}})}if(h){}var d=this.buildTripListEx(g,f);return d},updateFutureTrips:function(a){$("#show-trip-profile").fadeOut("fast",$.proxy(function(){if(a===undefined){}else{if(a===null){$("#no-trip").fadeIn()}else{var c="#show-trips";if(!a.trips||a.trips.length<=0){$("#no-trip").fadeIn()}else{if(a.trips.length>0){var b=this.buildTripList(a,true,true,true).attr("id","upcoming-trip-list");$("ul#upcoming-trip-list").remove();$("div#upcoming-trips-list-section").append(b);$("#backtotrips").hide();$("#show-trips").fadeIn()}else{$("#no-trip").fadeIn()}}}}},this))},handleGetTripsDataSuccessHasError:function(a){if(a.err_msg!==undefined){if(a.err_msg!=""){}else{}}else{}},ToggleProfile:function(){var a={};a.toggle=1;$.ajax({type:"POST",url:"api/toggleprofile.php",data:{fbid:CMC.me.id?CMC.me.id:"",profileinfo:encode64(JSON.stringify(a))},dataType:"json",context:this,success:this.onToggleSuccess,error:this.onToggleError})},onToggleSuccess:function(b,c,a){if(b.has_error!==undefined&&b.has_error!==null){if(b.has_error){this.handleToggleSuccessHasError(b)}else{if(CMC.isreceiver==1){$("#profile-organizer-dialog").dialog("close");$("#profile-toggle-dialog").dialog("open");$("#profile-toggle-dialog").dialog().dialog("widget").find(".ui-dialog-titlebar-close").hide();CMC.isreceiver=0;CMC.editProfile()}else{if(CMC.isreceiver==0){$("#profile-volunteer-dialog").dialog("close");$("#profile-toggle-dialog").dialog("open");$("#profile-toggle-dialog").dialog().dialog("widget").find(".ui-dialog-titlebar-close").hide();CMC.isreceiver=1;CMC.editProfile()}}}}else{this.handleGenericUnexpectedCallbackError(b,c,a,"future trips data")}},onToggleError:function(a,c,b){this.handleGenericServerError(a,c,b)},handleToggleSuccessHasError:function(a){if(a.err_msg!==undefined){if(a.err_msg!=""){}else{}}else{}},editTripProfile:function(a){$.ajax({type:"POST",url:"api/profileT.php",data:{tripid:a,fbid:CMC.me.id?CMC.me.id:"",},dataType:"json",context:this,success:this.onGetTripProfileDataSuccessEdit,error:this.onGetTripProfileDataError})},getTripProfile:function(a){$.ajax({type:"POST",url:"api/profileT.php",data:{tripid:a,fbid:CMC.me.id?CMC.me.id:"",},dataType:"json",context:this,success:this.onGetTripProfileDataSuccess,error:this.onGetTripProfileDataError})},onGetTripProfileDataSuccess:function(b,c,a){if(b.has_error!==undefined&&b.has_error!==null){if(b.has_error){this.handleGetTripProfileDataSuccessHasError(b)}else{this.showTripProfile(b)}}else{this.handleGenericUnexpectedCallbackError(b,c,a,"trip profile data")}},onGetTripProfileDataSuccessEdit:function(b,c,a){if(b.has_error!==undefined&&b.has_error!==null){if(b.has_error){this.handleGetTripProfileDataSuccessHasError(b)}else{this.editTrip(b)}}else{this.handleGenericUnexpectedCallbackError(b,c,a,"trip profile data")}},handleGetTripProfileDataSuccessHasError:function(a){if(a.err_msg!==undefined){if(a.err_msg!=""){}else{}}else{}},showTripProfile:function(b){if(b===undefined){}else{if(b==null){$("#no-trip").fadeIn()}else{var d="#tripprofilecontent";this.ajaxNotifyStart();$("#profile-trip-owner").html(b.tripowner?b.tripowner:"");this.tripuserid=b.creatorid;$("#trip-owner-picture").children("img").attr("src","https://graph.facebook.com/"+CMC.tripuserid+"/picture?type=large");$("#trip-profile-about").html(b.tripdesc?"<h4>"+b.tripdesc+"</h4>":"");if(b.tripname===undefined){$("#profile-trip-name").html("")}else{$("#profile-trip-name").html(b.tripname?b.tripname:"")}if(b.website===undefined){$("#profile-trip-url").html("")}else{$("#profile-trip-url").html(b.website?b.website:"")}if((b.destination===undefined)&&(b.destinationcountry===undefined)){$("#profile-trip-dest").html("")}else{if(b.destination===undefined){$("#profile-trip-dest").html(b.destinationcountry);$("#profile-trip-dest").html(b.destination)}else{$("#profile-trip-dest").html(b.destination+","+b.destinationcountry)}}if(b.email===undefined){$("#profile-trip-email").html("")}else{$("#profile-trip-email").html(b.email?b.email:"")}if(b.phone===undefined){$("#profile-trip-phone").html("")}else{$("#profile-trip-phone").html(b.phone?b.phone:"")}if(b.tripstage===undefined){$("#profile-trip-stage").html("")}else{$("#profile-trip-stage").html(b.tripstage?b.tripstage:"")}if(b.departyear===undefined){$("#profile-trip-depart").html("")}else{$("#profile-trip-depart").html(b.departyear?b.departmonth+"/"+b.departday+"/"+b.departyear:"")}if(b.returnyear===undefined){$("#profile-trip-return").html("")}else{$("#profile-trip-return").html(b.returnyear?b.returnmonth+"/"+b.returnday+"/"+b.returnyear:"")}if(b.religion===undefined){$("#profile-trip-religion").html("")}else{$("#profile-trip-religion").html(b.religion?b.religion:"")}if(b.acco===undefined){$("#profile-trip-acco").html("")}else{$("#profile-trip-acco").html(b.acco?b.acco:"")}if(b.numpeople===undefined){$("#profile-trip-numpeople").html("")}else{$("#profile-trip-numpeople").html(b.numpeople?b.numpeople:"")}if(b.MedicalSkills==undefined){$("#profile-trip-medskills").html("")}else{if(b.MedicalSkills.length>0){var c="<ul>";for(var a in b.MedicalSkills){c+="<li> "+b.MedicalSkills[a]+"</li>"}c+="</ul>";$("#profile-trip-medskills").html(b.MedicalSkills?c:"")}else{$("#profile-trip-medskills").html("")}}if(b.Non_MedicalSkills==undefined){$("#profile-trip-nonmedskills").html("")}else{if(b.Non_MedicalSkills.length>0){var c="<ul>";for(var a in b.Non_MedicalSkills){c+="<li> "+b.Non_MedicalSkills[a]+"</li>"}c+="</ul>";$("#profile-trip-nonmedskills").html(b.Non_MedicalSkills?c:"")}else{$("#profile-trip-nonmedskills").html("")}}if(b.SpiritualSkills==undefined){$("#profile-trip-spiritskills").html("")}else{if(b.SpiritualSkills.length>0){var c="<ul>";for(var a in b.SpiritualSkills){c+="<li> "+b.SpiritualSkills[a]+"</li>"}c+="</ul>";$("#profile-trip-spiritskills").html(b.SpiritualSkills?c:"")}else{$("#profile-trip-spiritskills").html("")}}if(b.memberids===undefined){$("#profile-trip-people").html("")}else{if(b.memberids.length>0){var c="";for(var a in b.memberids){c+='<div id="cmc-trip-member-'+a+'" class="cmc-tripmember-results">';c+='<div id="profile-tripmember-image">';c+='<img class="profile-tripmember-picture" src="ajax-spinner.gif">';c+="</div>";c+='<div class="profile-tripmember-name">Member Name</div>';c+="</div>"}$("#profile-trip-people").html(b.memberids?c:"");for(var a in b.memberids){id2="#profile-trip-people";FB.api(b.memberids[a],function(e){$(id2).children("#cmc-trip-member-"+a).children(".profile-tripmember-name").html(e.name?e.name:"");$(id2).children("#cmc-trip-member-"+a).children("#profile-tripmember-image").children("img.profile-tripmember-picture").attr("src","https://graph.facebook.com/"+b.memberids[a]+"/picture")});$("#cmc-trip-member-"+a).attr("fbid",b.memberids[a]);$(".cmc-tripmember-results").click(function(){CMC.handleShowTripMemberProfile(this)})}}else{$("#profile-trip-people").html("")}}$("#tabs").tabs("select",2);this.ajaxNotifyComplete();$("#show-trips").hide();$("#backtotrips").fadeIn();$("#show-trip-profile").fadeIn()}}},joinTrip:function(a){$.ajax({type:"POST",url:"api/addtripmember.php",data:{fbid:CMC.me.id?CMC.me.id:undefined,tripid:a,type:2},dataType:"json",context:this,success:function(b){if(!b.has_error){CMC.getProfile(CMC.me.id,false,CMC.handleGetProfileCallbackSaveAndShow);alert("You have successfully joined the trip.")}else{alert("Sorry, you could not be added to the trip because: "+b.err_msg)}},error:function(b){alert("Sorry, you could not be added to the trip because: "+b.err_msg)}})},leaveTrip:function(a){$.ajax({type:"POST",url:"api/deletetripmembers.php",data:{fbid:CMC.me.id?CMC.me.id:undefined,tripid:a},dataType:"json",context:this,success:function(b){if(!b.has_error){CMC.getProfile(CMC.me.id,false,CMC.handleGetProfileCallbackSaveAndShow);alert("You have successfully left the trip.")}else{if(b.membercount==1){$.ajax({type:"POST",url:"api/deletetrips.php",data:{tripid:a},dataType:"json",context:this,success:function(c){if(!c.has_error){CMC.getProfile(CMC.me.id,false,CMC.handleGetProfileCallbackSaveAndShow);alert("You have successfully left the trip.")}else{alert("Sorry, you could not leave the trip because: "+c.err_msg)}},error:function(c){alert("Sorry, you could not leave the trip because: "+c.err_msg)}})}else{alert("Sorry, you could not leave the trip because: "+b.err_msg)}}},error:function(b){alert("Sorry, you could not leave the trip because: "+b.err_msg)}})},obtainSearchLock:function(){var a=null;if(this.isSearchLocked){}else{this._searchLockKeyExpected="lock"+this._lastSearchLockKeyGenerated;a=this._lastSearchLockKeyGenerated;this.isSearchLocked=true;this._lastSearchLockKeyGenerated++}return a},releaseSearchLock:function(a){if(this.isSearchLocked){if("lock"+a==this._searchLockKeyExpected){this.isSearchLocked=false}else{}}else{}},handleSearchSelect:function(i){var g=null,j=false;try{g=jQuery.parseJSON(i)._value}catch(d){j=true}if(!j){if(g.substring(0,2)=="!!"){if(g.substring(2,3)=="z"){if(this.SearchState.z!=undefined){var a="!!z:"+this.SearchState.z[0]+":"+this.SearchState.z[1];var b=$('li.bit-box[rel="'+a+'"]').filter(":first").html().split("<",1)[0];var h=this.obtainSearchLock();$("#search-box-select").trigger("removeItem",{value:a});if(g==a){$("#search-box-select").trigger("addItem",[{title:b,value:a}])}this.releaseSearchLock(h)}this.SearchState.z=[g.substring(4,9),g.substring(10,g.length)]}else{if(g.substring(2,3)=="s"){var c=g.substring(4,g.length);if(this.SearchState.skills!=undefined){this.SearchState.skills.push(c)}else{this.SearchState.skills=[c]}}else{if(g.substring(2,3)=="c"){var f=g.substring(4,g.length);if(this.SearchState.countries!=undefined){this.SearchState.countries.push(f)}else{this.SearchState.countries=[f]}}else{}}}}else{this.SearchState.name=g}if(!this.isSearchLocked){this.search()}}},handleSearchRemove:function(c){var d=null,b=false;try{d=jQuery.parseJSON(c)._value}catch(f){b=true}if(!b){if(d.substring(0,2)=="!!"){var a=d.substring(2,3);if(a=="z"){delete this.SearchState.z}else{if(a=="s"){this.deleteObjectFromSearchState("skills",d.substring(4,d.length))}else{if(a=="c"){this.deleteObjectFromSearchState("countries",d.substring(4,d.length))}else{}}}}else{delete this.SearchState.name}if(!this.isSearchLocked){this.search()}}},deleteObjectFromSearchState:function(a,c){if(this.SearchState[a]){if(this.SearchState[a].length<=1){delete this.SearchState[a]}else{var d=false;var b=0;for(b=0;b<this.SearchState[a].length;b++){if(this.SearchState[a][b]==c){if(d){}else{this.SearchState[a].splice(b,1);d=true}}}}}else{}},search:function(){if(this.isSearchLocked){}else{var b=this.obtainSearchLock();this.searchPageCache=[];this.currentDisplayedSearchPage=1;this.updateSearchPagingControls();this.animateHideSearchResults();$(".cmc-search-result").each(function(){$(this).fadeOut("fast")});if(Object.keys(this.SearchState).length==0){var c=0,a=$.proxy(function(){c++;if(c==2){$("#cmc-search-results").hide()}},this);$("#cmc-search-results-title").fadeOut(400,a);$("#cmc-search-results-noresultmsg").fadeOut(400,a)}else{$("#cmc-search-results-noresultmsg").fadeOut(200);this.ajaxNotifyStart();$.ajax({type:"POST",url:"api/searchresults.php",data:{fbid:this.me.id?this.me.id:"",searchkeys:encode64(JSON.stringify(this.SearchState)),page:this.currentDisplayedSearchPage,perpage:20},dataType:"json",context:this,success:this.onSearchSuccess,error:this.onSearchError});$("#cmc-search-results-title").stop(true,true).fadeIn()}this.releaseSearchLock(b)}},onSearchSuccess:function(c,d,b){$(".cmc-search-result").each(function(){$(this).hide()});$("#cmc-search-results").show();if(c.has_error!==undefined&&c.has_error!==null){if(c.has_error){this.handleSearchSuccessHasError(c)}else{if(c.searchids===undefined){this.showSearchResults(null)}else{if(c.searchids===null){this.showSearchResults(null)}else{var a=c.searchids.length>10?c.searchids.slice(0,10):c.searchids;this.searchPageCache[1]=c.searchids.length>10?c.searchids.slice(10):null;this.getDataForEachFBID(a,$.proxy(function(e){this.searchPageCache[0]=e;this.showSearchResults(e)},this));if(c.searchids.length>10){this.getDataForEachFBID(this.searchPageCache[1],$.proxy(function(e){this.searchPageCache[1]=e},this))}}}}}else{this.handleGenericUnexpectedCallbackError(c,d,b,"search success")}this.updateSearchPagingControls()},onSearchError:function(a,c,b){this.ajaxNotifyComplete();this.handleGenericServerError(a,c,b)},handleSearchSuccessHasError:function(a){this.ajaxNotifyComplete();if(a.err_msg!==undefined){if(a.err_msg!=""){}else{}}else{}},getDataForEachFBID:function(f,i,j){if(j===null||j===undefined){j=false}var d=new Array(f.length),c=0,h=false;var e=setTimeout($.proxy(function(){if(c!=f.length){if(!j){if(!h){this.getDataForEachFBID(f,i,true)}else{}h=true}else{}}else{}},this),2000);var b=function(){c++;if(c==f.length&&!h){clearTimeout(e);i(d)}};for(var g in f){var a=function(k){if(!k){}else{if(k.error){CMC.handleFacebookResponseError(k)}}if(this.target){d[this.target]=k}else{}b()};a.target=g;FB.api("/"+f[g],$.proxy(a,a))}},coalesceDefinedSearchResults:function(a){var b=0;var d=function(h,g,f){var e=h[g];h[g]=h[f];h[f]=e};for(var c in a){if(a[c].id===undefined||a[c].id===undefined){b++}else{if(b>0){d(a,c-b,c)}}}},showSearchResults:function(c,g){g=g||false;if(g){$("#cmc-search-results").show()}if(c===undefined){}else{if(c==null||c.length==0){$("#cmc-search-results-noresultmsg").stop(true,true).fadeIn()}else{var f=0,b=$.proxy(function(){f++;if(f==c.length){this.animateShowSearchResults(c)}},this);if(!g){this.coalesceDefinedSearchResults(c)}if($(".result-picture img").length>0){if(!g){setTimeout($.proxy(function(){this.showSearchResults(c,true)},this),200);return}}for(var e in c){var h="#cmc-search-result-"+e;this.ajaxNotifyStart();$(h).children(".result-name").html(c[e].name?c[e].name:"");$(h).attr("fbid",c[e].id);$(h).attr("fblink",c[e].link);$(h).children("div.result-picture").children("img").remove();if(c[e].id){$("<img />").attr("src","https://graph.facebook.com/"+c[e].id+"/picture").attr("cmcid",h).addClass("srpic").one("load",$.proxy(function(i){$($(i.target).attr("cmcid")).children("div.result-picture").children("img").remove();$($(i.target).attr("cmcid")).children("div.result-picture").append($(i.target));this.ajaxNotifyComplete();b()},this))}else{var a=1;for(a=1;a<=4;a++){var d=setTimeout("$('"+h+"').children('.result-picture').children('img').hide();",100*a);this.searchPageImageClearJobQueue.push(d)}this.ajaxNotifyComplete();b()}}}}this.ajaxNotifyComplete()},animateShowSearchResults:function(c){var b=$(".cmc-search-result").length,a=0;$("#cmc-search-results").clearQueue("custom-SearchResultsQueue");var d=function(){for(var g in this.results){var h="#cmc-search-result-"+g,f=0,e=$.proxy(function(){++f;if(f==this.results.length){if(this.results.length<b){for(var i=b-this.results.length;i>0;i--){var j="#cmc-search-result-"+(b-i);$(j).delay(4*(b-i)).fadeOut("fast")}}}},this);if($(h+" .result-picture img").length>1){while($(h+" .result-picture img").length>1){$(h+" .result-picture img").filter(":first").remove();$(h+" .result-name div").html("");$(h).hide()}}$(h).stop(true,true).delay(25*g).show("drop",{direction:"right",distance:50},250,e)}$("#cmc-search-results").dequeue("custom-SearchResultsQueue")};d.results=c;d=$.proxy(d,d);$("#cmc-search-results").filter(":first").queue("custom-SearchResultsQueue",d).dequeue("custom-SearchResultsQueue")},animateHideSearchResults:function(d){var c=0,b=0,a=$.proxy(function(){c++;if(c==$(".cmc-search-result").length){$(".result-name").each(function(){$(this).html("")});$(".result-picture").each($.proxy(function(e,f){b++;$(f).children("img").remove();if(b==$(".result-picture").length){if(d!=undefined){d()}}},this))}},this);$(".cmc-search-result").queue("custom-SearchResultsQueue",function(){$(this).stop(true,true).fadeOut(100,function(){a()})}).dequeue("custom-SearchResultsQueue")},padSearchResults:function(d){var c=$(".cmc-search-result").length,b=0,a=d.slice(0);if(d.length<c){for(b=d.length;b<c;b++){a.push({id:false,name:false})}}return a},navigateToNextSearchPage:function(){var b=++this.currentDisplayedSearchPage-1,a;this.updateSearchPagingControls();this.ajaxNotifyStart();this.animateHideSearchResults($.proxy(function(){if(this.searchPageCache[b]!==undefined){this.showSearchResults(this.padSearchResults(this.searchPageCache[b]))}else{a=setInterval($.proxy(function(){if(this.searchPageCache[b]!==undefined){this.showSearchResults(this.padSearchResults(this.searchPageCache[b]));clearInterval(a)}},this),250)}},this));this.cacheSearchPage(b+1)},cacheSearchPage:function(a){if(this.searchPageCache[a]===undefined){this.ajaxNotifyStart();if(!this.me.id){}$.ajax({type:"POST",url:"api/searchresults.php",data:{fbid:this.me.id?this.me.id:"",searchkeys:encode64(JSON.stringify(this.SearchState)),page:a+1,perpage:10},dataType:"json",context:{invokeData:{index:a},cmc:this},success:this.onCacheSearchPageSuccess,error:this.onCacheSearchPageServerError})}},onCacheSearchPageSuccess:function(b,c,a){if("has_error" in b&&b.has_error!==undefined&&b.has_error!==null){if(b.has_error){this.cmc.handleSearchSuccessHasError(b)}else{if(!("searchids" in b)){this.cmc.searchPageCache[this.invokeData.index]=null}else{if(b.searchids===undefined){this.cmc.searchPageCache[this.invokeData.index]=null}else{if(b.searchids==null){this.cmc.searchPageCache[this.invokeData.index]=null}else{this.cmc.getDataForEachFBID(b.searchids,$.proxy(function(d){this.cmc.searchPageCache[this.invokeData.index]=d;this.cmc.updateSearchPagingControls()},this))}}}}}else{this.cmc.searchPageCache[this.invokeData.index]=null;this.cmc.handleGenericUnexpectedCallbackError(b,c,a,"search success")}this.cmc.updateSearchPagingControls();this.cmc.ajaxNotifyComplete()},onCacheSearchPageServerError:function(a,c,b){this.ajaxNotifyComplete();this.searchPageCache.push(null);this.handleGenericServerError(a,c,b)},navigateToPreviousSearchPage:function(){var b=0,a=0;this.currentDisplayedSearchPage--;this.updateSearchPagingControls();this.ajaxNotifyStart();if(this.searchPageImageClearJobQueue.length>0){while(this.searchPageImageClearJobQueue.length>0){clearTimeout(this.searchPageImageClearJobQueue.pop())}}if(this.searchPageCache[this.currentDisplayedSearchPage-1]!==undefined){this.animateHideSearchResults($.proxy(function(){this.showSearchResults(this.searchPageCache[this.currentDisplayedSearchPage-1])},this))}else{}this.updateSearchPagingControls()},updateSearchPagingControls:function(){$("#cmc-search-results-pagingctl-text").children(".ui-button-text").html("page "+this.currentDisplayedSearchPage);if(this.currentDisplayedSearchPage<=1){$("#cmc-search-results-pagingctl-prev").removeClass("ui-state-hover").button("disable")}else{$("#cmc-search-results-pagingctl-prev").button("enable")}if(this.searchPageCache[this.currentDisplayedSearchPage]!=null){$("#cmc-search-results-pagingctl-next").button("enable")}else{$("#cmc-search-results-pagingctl-next").removeClass("ui-state-hover").button("disable")}},animateSearchResultSelected:function(a){$(".cmc-search-result").not(a).each(function(){var b=function(){setTimeout($.proxy(function(){$(this).show().fadeTo(0,1)},this),300)};$(this).stop(true,true).show().hide("drop",{direction:"right",distance:115,easing:"easeOutQuart"},350,b).show(0).fadeTo(0,0)});setTimeout(function(){$("#tabs").tabs("select",1)},285)},handleSearchResultSelected:function(b){if($(b).children(".result-name").html()!=""){var d=$(b).attr("fbid");var c=$(b).attr("fblink");var a=function(e){if(!e.link){e.link=c}CMC.showProfile(e)};this.getProfile(d,true,a);this.animateSearchResultSelected(b)}else{}},animateTripMemberResultSelected:function(a){$(".cmc-tripmember-results").not(a).each(function(){var b=function(){setTimeout($.proxy(function(){$(this).show().fadeTo(0,1)},this),300)};$(this).stop(true,true).show().hide("drop",{direction:"right",distance:115,easing:"easeOutQuart"},350,b).show(0).fadeTo(0,0)});setTimeout(function(){$("#tabs").tabs("select",1)},285)},handleShowTripMemberProfile:function(a){if($(a).children(".profile-tripmember-name").html()!=""){var b=$(a).attr("fbid");this.getProfile(b,true,this.showProfile);this.animateTripMemberResultSelected(a)}else{}},emptyTripForm:function(){$(":input","#profile-trip-form").removeAttr("checked").removeAttr("selected");$(":text, :password, :file, select","#profile-trip-form").val("");$("input#profile-trip-depart").val("select");$("input#profile-trip-return").val("select");$("#profile-trip-medical-skills").multiselect("uncheckAll");$("#profile-trip-nonmedical-skills").multiselect("uncheckAll");$("#profile-trip-spiritual-skills").multiselect("uncheckAll")},editTrip:function(a){this.tripedit=1;this.checkFacebookLoginStatus($.proxy(function(b){if(b&&b.authResponse){if(this.me&&this.me.id){this.getProfile(this.me.id)}var g="#profile-trip-dialog";if(a.tripname!==undefined){$("input#profile-trip-name").val(a.tripname)}if(a.website!==undefined){$("input#profile-trip-website").val(a.website)}if(a.tripdesc!==undefined){$("input#profile-trip-about").val(a.tripdesc)}if(a.religion!==undefined){$('select#profile-trip-religion option[value="'+a.religion+'"]').attr("selected","selected")}if(a.numpeople!==undefined){$("input#profile-trip-number").val(a.numpeople)}if(a.departyear!==undefined){var e=String(a.departmonth)+"."+String(a.departday)+"."+String(a.departyear);$("input#profile-trip-depart").val(e)}if(a.returnyear!==undefined){var f=String(a.returnmonth)+"."+String(a.returnday)+"."+String(a.returnyear);$("input#profile-trip-return").val(f)}if(a.duration!==undefined){$('select#profile-trip-duration option[value="'+parseInt(a.duration,10)+'"]').attr("selected","selected")}if(a.acco!==undefined){$('select#profile-trip-acco option[value="'+a.acco+'"]').attr("selected","selected")}if(a.tripstage!==undefined){$('select#profile-trip-stage option[value="'+parseInt(a.tripstage,10)+'"]').attr("selected","selected")}if(a.destination!==undefined){$("input#profile-trip-city").val(a.destination)}if(a.destinationcountry!==undefined){$('select#profile-trip-country option[value="'+parseInt(a.countryid,10)+'"]').attr("selected","selected")}if(a.zip!==undefined){$("input#profile-trip-zipcode").val(a.zip)}if(a.languages!==undefined){var c=a.languages.split(",");if(c.length>0){for(var d in c){$('select#profile-trip-languages option[value="'+parseInt(a.languageid[d],10)+'"]').attr("selected","selected")}}}if(a.email!==undefined){$("input#profile-trip-email").val(a.email)}if(a.phone!==undefined){$("input#profile-trip-phone").val(a.phone)}if(a.MedicalSkills!==undefined){if(a.MedicalSkills.length>0){for(var d in a.MedicalSkills){$('select#profile-trip-medical-skills option[value="'+a.MedicalSkillsid[d]+'"]').attr("selected","selected")}}}$("#profile-trip-medical-skills").multiselect();$("#profile-trip-medical-skills").multiselect("refresh");if(a.Non_MedicalSkills!==undefined){if(a.Non_MedicalSkills.length>0){for(var d in a.Non_MedicalSkills){$('select#profile-trip-nonmedical-skills option[value="'+a.Non_MedicalSkillsid[d]+'"]').attr("selected","selected")}}}$("#profile-trip-nonmedical-skills").multiselect();$("#profile-trip-nonmedical-skills").multiselect("refresh");if(a.SpiritualSkills!==undefined){if(a.SpiritualSkills.length>0){for(var d in a.SpiritualSkills){$('select#profile-trip-spiritual-skills option[value="'+a.SpiritualSkillsid[d]+'"]').attr("selected","selected")}}}$("#profile-trip-spiritual-skills").multiselect();$("#profile-trip-spiritual-skills").multiselect("refresh");this.tripdata=a;$("#profile-trip-dialog").dialog("open")}},this))},editProfile:function(a){a=a===undefined?false:a;this.profileedit=!a;this.checkFacebookLoginStatus($.proxy(function(b){if(b&&b.authResponse){if(this.me&&this.me.id){this.getProfile(this.me.id)}if(this.profiledata){if(this.isreceiver==0){var d="#profile-volunteer-dialog";if(this.profiledata.zip!==undefined){$("input#profile-zipcode").val(this.profiledata.zip)}if(this.profiledata.about!==undefined){$("input#profile-about").val(this.profiledata.about)}if(this.profiledata.MedicalSkills!==undefined){if(this.profiledata.MedicalSkills.length>0){for(var c in this.profiledata.MedicalSkills){$('select#profile-medical-skills option[value="'+this.profiledata.MedicalSkillsid[c]+'"]').attr("selected","selected")}}}$("#profile-medical-skills").multiselect();if(this.profiledata.Non_MedicalSkills!==undefined){if(this.profiledata.Non_MedicalSkills.length>0){for(var c in this.profiledata.Non_MedicalSkills){$('select#profile-nonmedical-skills option[value="'+this.profiledata.Non_MedicalSkillsid[c]+'"]').attr("selected","selected")}}}$("#profile-nonmedical-skills").multiselect();if(this.profiledata.SpiritualSkills!==undefined){if(this.profiledata.SpiritualSkills.length>0){for(var c in this.profiledata.SpiritualSkills){$('select#profile-spiritual-skills option[value="'+this.profiledata.SpiritualSkillsid[c]+'"]').attr("selected","selected")}}}$("#profile-spiritual-skills").multiselect();if(this.profiledata.relg!==undefined){$('select#profile-religion option[value="'+this.profiledata.relg+'"]').attr("selected","selected")}if(this.profiledata.Durations!==undefined){if(this.profiledata.Durations.PreferredDurationofMissionTrips!==undefined){$('select#profile-duration option[value="'+parseInt(this.profiledata.Durations.PreferredDurationofMissionTrips,10)+'"]').attr("selected","selected")}}if(this.profiledata.States!==undefined){if(this.profiledata.States.State!==undefined){$('select#profile-state option[value="'+this.profiledata.States.Stateid+'"]').attr("selected","selected")}}if(this.profiledata.city!==undefined){$("input#profile-city").val(this.profiledata.city)}if(this.profiledata.country!==undefined){$("input#profile-country").val(this.profiledata.country)}if(this.profiledata.GeographicAreasofInterest!==undefined){if(this.profiledata.GeographicAreasofInterest.Regions!==undefined){if(this.profiledata.GeographicAreasofInterest.Regions.length>0){for(var c in this.profiledata.GeographicAreasofInterest.Regionsid){$('select#profile-region option[value="'+this.profiledata.GeographicAreasofInterest.Regionsid[c]+'"]').attr("selected","selected")}}}}$("#profile-region").multiselect();if(this.profiledata.GeographicAreasofInterest!==undefined){if(this.profiledata.GeographicAreasofInterest.Countries!==undefined){if(this.profiledata.GeographicAreasofInterest.Countries.length>0){for(var c in this.profiledata.GeographicAreasofInterest.Countriesid){$('select#profile-country-served option[value="'+this.profiledata.GeographicAreasofInterest.Countriesid[c]+'"]').attr("selected","selected")}}}}$("#profile-country-served").multiselect();if(this.profiledata.phone!==undefined){$("input#profile-phone").val(this.profiledata.phone)}if(this.profiledata.email!==undefined){$("input#profile-email").val(this.profiledata.email)}if(this.profiledata.misexp!==undefined){$("input#profile-experience").val(this.profiledata.misexp)}$(d).children("form").children("#wrapper").children("#contents").children(".profile-container").children(".profile-header").html("Please edit your profile information")}else{var d="#profile-organizer-dialog";if(this.profiledata.zip!==undefined){$("input#profile-org-zipcode").val(this.profiledata.zip)}if(this.profiledata.AgencyName!==undefined){$("input#profile-org-name").val(this.profiledata.AgencyName)}if(this.profiledata.AgencyWebsite!==undefined){$("input#profile-org-website").val(this.profiledata.AgencyWebsite)}if(this.profiledata.about!==undefined){$("input#profile-org-about").val(this.profiledata.about)}if(this.profiledata.FacilityMedicalOfferings!==undefined){if(this.profiledata.FacilityMedicalOfferings.length>0){for(var c in this.profiledata.FacilityMedicalOfferings){$('select#profile-org-offer option[value="'+this.profiledata.FacilityMedicalOfferingsid[c]+'"]').attr("selected","selected")}}}$("#profile-org-offer").multiselect();if(this.profiledata.FacilityNon_MedicalOfferings!==undefined){if(this.profiledata.FacilityNon_MedicalOfferings.length>0){for(var c in this.profiledata.FacilityNon_MedicalOfferings){$('select#profile-org-offern option[value="'+this.profiledata.FacilityNon_MedicalOfferingsid[c]+'"]').attr("selected","selected")}}}$("#profile-org-offern").multiselect();if(this.profiledata.MedicalSkills!==undefined){if(this.profiledata.MedicalSkills.length>0){for(var c in this.profiledata.MedicalSkills){$('select#profile-org-medical option[value="'+this.profiledata.MedicalSkillsid[c]+'"]').attr("selected","selected")}}}$("#profile-org-medical").multiselect();if(this.profiledata.Non_MedicalSkills!==undefined){if(this.profiledata.Non_MedicalSkills.length>0){for(var c in this.profiledata.Non_MedicalSkills){$('select#profile-org-nonmedical option[value="'+this.profiledata.Non_MedicalSkillsid[c]+'"]').attr("selected","selected")}}}$("#profile-org-nonmedical").multiselect();if(this.profiledata.SpiritualSkills!==undefined){if(this.profiledata.SpiritualSkills.length>0){for(var c in this.profiledata.SpiritualSkills){$('select#profile-org-spiritual option[value="'+this.profiledata.SpiritualSkillsid[c]+'"]').attr("selected","selected")}}}$("#profile-org-spiritual").multiselect();if(this.profiledata.relg!==undefined){$('select#profile-org-religion option[value="'+this.profiledata.relg+'"]').attr("selected","selected")}if(this.profiledata.Durations!==undefined){if(this.profiledata.Durations.PreferredDurationofMissionTrips!==undefined){$('select#profile-org-duration option[value="'+parseInt(this.profiledata.Durations.PreferredDurationofMissionTripsid,10)+'"]').attr("selected","selected")}}if(this.profiledata.States!==undefined){if(this.profiledata.States.State!==undefined){$('select#profile-org-state option[value="'+this.profiledata.States.Stateid+'"]').attr("selected","selected")}}if(this.profiledata.city!==undefined){$("input#profile-org-city").val(this.profiledata.city)}if(this.profiledata.country!==undefined){$("input#profile-org-country").val(this.profiledata.country)}if(this.profiledata.GeographicAreasofInterest!==undefined){if(this.profiledata.GeographicAreasofInterest.Regions!==undefined){if(this.profiledata.GeographicAreasofInterest.Regions.length>0){for(var c in this.profiledata.GeographicAreasofInterest.Regions){$('select#profile-org-region option[value="'+this.profiledata.GeographicAreasofInterest.Regionsid[c]+'"]').attr("selected","selected")}}}}$("#profile-org-region").multiselect();if(this.profiledata.GeographicAreasofInterest!==undefined){if(this.profiledata.GeographicAreasofInterest.Countries!==undefined){if(this.profiledata.GeographicAreasofInterest.Countries.length>0){for(var c in this.profiledata.GeographicAreasofInterest.Countries){$('select#profile-org-countryserved option[value="'+this.profiledata.GeographicAreasofInterest.Countriesid[c]+'"]').attr("selected","selected")}}}}$("#profile-org-countryserved").multiselect();if(this.profiledata.phone!==undefined){$("input#profile-org-phone").val(this.profiledata.phone)}if(this.profiledata.email!==undefined){$("input#profile-org-email").val(this.profiledata.email)}if(this.profiledata.misexp!==undefined){$("input#profile-org-experience").val(this.profiledata.misexp)}$(d).children("form").children("#wrapper").children("#contents").children(".profile-container").children(".profile-header").html("Please edit your profile information")}}if(this.isreceiver){$("#profile-organizer-dialog").dialog("open")}else{$("#profile-volunteer-dialog").dialog("open")}}else{this.login($.proxy(function(e){if(e&&e.authResponse){this.editProfile(a)}},this))}},this))},retrieveOneFormField:function(d,a,f){f=f||false;var c=$(d).find(a);var b=undefined;if(c){if(c.size()>0){if(c.size()==1){var e=c.val();if(e!=""||f){b=e}}else{}}else{}}else{}return b},fetchIgnorableFormFields:function(a){a=a||false;if(!this.ignorableFormFields||a){this.ignorableFormFields={};var b=this;$(".cmc-default-opt").each(function(c,e){var f=$(e);var g=f.val();var d=f.html();$.proxy(function(){if(g&&g!=""&&!this.ignorableFormFields.hasOwnProperty(g)){this.ignorableFormFields[g]=true}if(d&&d!=""&&d!=g&&!this.ignorableFormFields.hasOwnProperty(d)){this.ignorableFormFields[d]=true}},b)()})}return this.ignorableFormFields},stripIgnorableFormFields:function(a){var c=this.fetchIgnorableFormFields();for(var b in a){if(a.hasOwnProperty(b)){if(a[b]!==undefined&&c.hasOwnProperty(a[b])&&c[a[b]]){delete a[b]}}}return a},getFormData:function(c,d){d=d||false;var b={};var a=$(c).find(".cmc-form-spec");a.each(function(f,g){var e=$(g).attr("id");var h=CMC.retrieveOneFormField(c,"#"+e,d);if(h!=undefined){b[e]=h}});b=this.stripIgnorableFormFields(b);return b},submitProfile:function(d){var i=false;var b=false;var e="";var h=1;var g=false;if(d.hasOwnProperty("profile-zipcode")){i=this.validateZipCode(d["profile-zipcode"]);if(!i){e+=h+". Incorrect Zipcode format entered\n";h=h+1;isValid=false}}if(d.hasOwnProperty("profile-email")){b=this.validateEmail(d["profile-email"]);if(!b){e+=h+". Incorrect Email format entered\n";h=h+1;isValid=false}}if(d.hasOwnProperty("profile-phone")){var c=d.hasOwnProperty("profile-country")?d["profile-country"]:null;var f=this.validatePhone(d["profile-phone"],c);if(f!=""){e+=h+" "+f+"\n";h=h+1;isValid=false}}if(e!=""){alert("Some input fields need correction:\n"+e)}else{var a={};a.profiletype=1;if(CMC.profileedit==1){a.update=1}$.extend(a,this.applyTranslationMap(d,this.BackendTranslation.Profile));$.ajax({type:"POST",url:"api/profilein.php",data:{fbid:CMC.me.id?CMC.me.id:"",profileinfo:encode64(JSON.stringify(a))},dataType:"json",context:this,success:this.onSubmitSuccess,error:this.onSubmitFailure});g=true}return g},onSubmitSuccess:function(b,c,a){if(!b.has_error){CMC.getProfile(CMC.me.id,false,this.handleGetProfileCallbackSaveAndShow);$("#profile-volunteer-dialog").dialog("close");alert("Thank you - your submission has been successfully entered into our database");if(this.isFirstRun){this.isFirstRun=false;$("#no-profile-trip").hide();this.getFutureTrips()}}else{alert("We are sorry - there was an error: "+b.err_msg)}},onSubmitFailure:function(a,c,b){this.handleGenericServerError(a,c,b);alert("Sorry, we aren't able to save your profile right now. Try again later.")},submitorgProfile:function(d){var i=false;var b=false;var e="";var j;var h=1;var g=false;if(d.hasOwnProperty("profile-org-website")){if(!CMC.isUrl(d["profile-org-website"])){e+=h+". Incorrect Website Entered\n";h=h+1;j=false}}if(d.hasOwnProperty("profile-org-zipcode")){i=CMC.validateZipCode(d["profile-org-zipcode"]);if(!i){e+=h+". Incorrect Zipcode format entered\n";h=h+1;j=false}}if(d.hasOwnProperty("profile-org-email")){b=CMC.validateEmail(d["profile-org-email"]);if(!b){e+=h+". Incorrect Email format entered\n";h=h+1;j=false}}if(d.hasOwnProperty("profile-org-phone")){var c=d.hasOwnProperty("profile-org-country")?d["profile-org-country"]:null;var f=CMC.validatePhone(d["profile-org-phone"],c);if(f!=""){e+=h+" "+f+"\n";h=h+1;j=false}}if(e!=""){alert("Some input fields need correction:\n"+e)}else{var a={};a.profiletype=3;if(this.profileedit==1){a.update=1}$.extend(a,this.applyTranslationMap(d,this.BackendTranslation.OrganizerProfile));$.ajax({type:"POST",url:"api/profilein.php",data:{fbid:CMC.me.id?CMC.me.id:"",profileinfo:encode64(JSON.stringify(a))},context:this,dataType:"json",success:this.onSubmitorgSuccess,error:this.onSubmitorgFailure});g=true}return g},onSubmitorgSuccess:function(b,c,a){if(!b.has_error){this.getProfile(this.me.id,false,this.handleGetProfileCallbackSaveAndShow);$("#profile-organizer-dialog").dialog("close");alert("Thank you - your submission has been successfully entered into our database")}else{alert("We are sorry - there was an error: "+b.err_msg)}},onSubmitorgFailure:function(a,c,b){this.handleGenericServerError(a,c,b);alert("Sorry, we're having trouble saving your profile. Try again later.")},submitTripProfile:function(g){var c=false;var f=false;var r="";var p;var u=1;var v=false;var m;var b;var j,h,s;var q,i,k;if(g.hasOwnProperty("profile-trip-website")){if(!CMC.isUrl(g["profile-trip-website"])){r+=u+". Incorrect Website Entered\n";u=u+1;p=false}}if(g.hasOwnProperty("profile-trip-zipcode")){c=CMC.validateZipCode(g["profile-trip-zipcode"]);if(!c){r+=u+". Incorrect Zipcode format entered\n";u=u+1;p=false}}if(g.hasOwnProperty("profile-trip-email")){f=CMC.validateEmail(g["profile-trip-email"]);if(!f){r+=u+". Incorrect Email format entered\n";u=u+1;p=false}}if(g.hasOwnProperty("profile-trip-phone")){var n=g.hasOwnProperty("profile-trip-country")?g["profile-trip-country"]:null;var o=CMC.validatePhone(g["profile-trip-phone"],n);if(o!=""){r+=u+" "+o+"\n";u=u+1;p=false}}if(g.hasOwnProperty("profile-trip-depart")){m=g["profile-trip-depart"];if(m=="select"){r+=u+" Trip should have a depart date\n";u=u+1;p=false}}if(g.hasOwnProperty("profile-trip-return")){b=g["profile-trip-return"];if(b=="select"){r+=u+" Trip should have a return date\n";u=u+1;p=false}}var a,d;if(m!=""){var l=m.split(".");j=parseInt(l[0],10);h=parseInt(l[1],10);s=parseInt(l[2],10);a=new Date();a.setFullYear(s,j,h)}if(b!=""){var e=b.split(".");q=parseInt(e[0],10);i=parseInt(e[1],10);k=parseInt(e[2],10);d=new Date();d.setFullYear(k,q,i)}if(a>d){r+=u+" Trip departure date should be before the return date\n";u=u+1;p=false}if(r!=""){alert("Some input fields need correction:\n"+r)}else{var t={};t.profiletype=2;t.DepartMonth=j;t.DepartDay=h;t.DepartYear=s;t.ReturnMonth=q;t.ReturnDay=i;t.ReturnYear=k;$.extend(t,this.applyTranslationMap(g,this.BackendTranslation.TripProfile));$.ajax({type:"POST",url:"api/profilein.php",data:{tripid:CMC.tripdata.hasOwnProperty("tripid")&&CMC.tripdata.tripid?CMC.tripdata.tripid:undefined,fbid:CMC.me.id?CMC.me.id:"",profileinfo:encode64(JSON.stringify(t))},context:this,dataType:"json",success:this.onSubmitTripSuccess,error:this.onSubmitTripFailure});v=true}return v},onSubmitTripSuccess:function(b,c,a){if(!b.has_error){$("#profile-trip-dialog").dialog("close");this.refreshUserProfile();if(this.tripedit){alert("Congratulations! Your trip has been edited!")}else{alert("Congratulations! Your trip has been created!")}}else{if(this.tripedit){alert("We are sorry, your trip was not edited because: "+b.err_msg)}else{alert("We are sorry - there was an error: "+b.err_msg)}}},onSubmitTripFailure:function(a,c,b){this.handleGenericServerError(a,c,b);alert("Sorry, we aren't able to save your trip right now. Try again later.")},createTrip:function(){this.emptyTripForm();this.tripdata={};$("#profile-trip-dialog").dialog("open")},validateZipCode:function(c){var b=false;var a=/^\d{5}$|^\d{5}-\d{4}$/;b=a.test(c);return b},validateEmail:function(c){var b=false;var a=/^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+[\.]{1}[a-zA-Z]{2,4}$/;b=a.test(c);return b},isUrl:function(a){var b=/((ftp|http|https):\/\/)?(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/;return b.test(a)},validatePhone:function(b,c){var a="";return a},handleFacebookResponseError:function(a){if(a.error){if(typeof a.error=="string"){}else{}}else{}},handleUserUnauthorized:function(){$("#no-profile").fadeIn();$("#no-profile-trip").fadeIn();this.isFirstRun=true},cacheFacebookResponseProperties:function(a){if(a){if(a.hasOwnProperty("authResponse")&&a.authResponse){if(a.authResponse.hasOwnProperty("accessToken")){this.accessToken=a.authResponse.accessToken}else{this.accessToken=null}}else{this.accessToken=null}}else{}},cacheFacebookData:function(a,d){CMC.ajaxNotifyStart();var c=0;var b=function(){if(++c>=2){if(d){d()}}};FB.api("/me",$.proxy(function(e){this.ajaxNotifyComplete();if(e){if(e.error){this.handleFacebookResponseError(e)}else{this.me=e;if(a){this.getProfile(this.me.id,false,function(f){this.handleGetProfileCallbackSave(f);b()})}else{b()}}}else{}},this));CMC.ajaxNotifyStart();FB.api("/me/friends",$.proxy(function(e){this.ajaxNotifyComplete();if(e){if(e.error){this.handleFacebookResponseError(e)}else{this.friends=e.data}b()}else{}},this))},checkFacebookLoginStatus:function(d){CMC.ajaxNotifyStart();var a=false;var b=setTimeout($.proxy(function(){this.ajaxNotifyComplete();if(!a){}else{}},this),2500);var c=function(){a=true;clearTimeout(b)};FB.getLoginStatus(function(e){CMC.ajaxNotifyComplete();c();CMC.cacheFacebookResponseProperties(e);if(e.authResponse){}else{CMC.hideTabLoading("profile")}if(d){d(e)}})},login:function(a){CMC.ajaxNotifyStart();FB.login(function(b){CMC.ajaxNotifyComplete();if(b.authResponse){CMC.cacheFacebookResponseProperties(b);CMC.cacheFacebookData(true)}else{CMC.hideTabLoading("profile")}if(a){a(b)}})}};FB.init({appId:"305928355832",status:true,cookie:true,fbml:true,oauth:true});$(function(){CMC.performStartupActions();$("#make-profile, #make-volunteer, #make-organizer").hide();$("#make-trip, #profile-trip-dialog").hide();$("#make-volunteer-link").click(function(){CMC.isreceiver=false;CMC.editProfile(true)});$("#profile-volunteer-dialog").dialog({autoOpen:false,draggable:true,position:[25,25],resizable:true,width:700,height:465,open:function(){CMC.dialogOpen(this)},close:function(){CMC.dialogClose(this)}});$("#edit-volunteer-dialog").dialog({autoOpen:false,draggable:true,position:[25,25],resizable:true,width:700,height:465,open:function(){CMC.dialogOpen(this)},close:function(){CMC.dialogClose(this)}});$("#make-organizer-link").click(function(){CMC.isreceiver=true;CMC.editProfile(true)});$("#profile-organizer-dialog").dialog({autoOpen:false,draggable:true,position:[25,25],resizable:true,width:700,height:465,open:function(){CMC.dialogOpen(this)},close:function(){CMC.dialogClose(this)}});$("#profile-toggle-dialog").dialog({autoOpen:false,draggable:false,position:["center",200],resizable:false,width:150,height:75,open:function(){CMC.dialogOpen(this)},close:function(){CMC.dialogClose(this)}});$("#make-trip").click(function(){$("#profile-trip-languages").multiselect();$("#profile-trip-dialog").dialog("open")});$("#profile-trip-dialog").dialog({autoOpen:false,draggable:true,position:[25,25],resizable:true,width:700,height:465,open:function(){CMC.dialogOpen(this)},close:function(){CMC.dialogClose(this)}});$(".cmc-big-button").hover(function(){$(this).addClass("ui-state-hover")},function(){$(this).removeClass("ui-state-hover")});$("#tabs").tabs({fx:{opacity:"toggle",duration:"fast"}});CMC.processURL();$("#ajax-spinner").hide().ajaxStart(function(){CMC.ajaxNotifyStart()}).ajaxStop(function(){CMC.ajaxNotifyComplete()});$("#profile-controls-edit").button({text:false,icons:{primary:"ui-icon-pencil"}}).click(function(){CMC.editProfile()});$("#profile-controls-create-trip").button({text:false,icons:{primary:"ui-icon-suitcase"}}).click(function(){CMC.createTrip()});$("#profile-controls-back-to-my-profile").button({text:false,icons:{primary:"ui-icon-arrowreturnthick-1-w"}}).click(function(){CMC.getProfile(CMC.me.id,true,CMC.handleGetProfileCallbackSaveAndShow)});$("#trip-profile-controls-back-to-trips").button({text:false,icons:{primary:"ui-icon-arrowreturnthick-1-w"}}).click(function(){CMC.getFutureTrips()});$("#search-box-select").fcbkcomplete({addontab:true,cache:true,complete_text:"Start typing...",filter_hide:true,filter_selected:true,firstselected:true,height:6,maxshownitems:5,newel:true,onselect:function(b){CMC.handleSearchSelect(b)},onremove:function(b){CMC.handleSearchRemove(b)},cmc_zipcode_detect:true,zipcode_target:"api/zipcode.php"});$("#search-tipbar-left .tipbar-link").click(function(){$(this).focus();$(this).tipTip("show")}).blur(function(){$(this).tipTip("hide")}).tipTip({activation:"manual",keepAlive:true,maxWidth:"230px",forceWidth:true,delay:0,defaultPosition:"bottom",forcePosition:true,content:$("#search-tipbar-left .tipbar-content").html()});$("#search-tipbar-right .tipbar-link").click(function(){$(this).focus();$(this).tipTip("show")}).blur(function(){$(this).tipTip("hide")}).tipTip({activation:"manual",keepAlive:true,maxWidth:"230px",forceWidth:true,delay:25,defaultPosition:"bottom",forcePosition:true,content:$("#search-tipbar-right .tipbar-content").html()});if($.browser.msie&&parseInt($.browser.version,10)<=7){$("#tiptip_content").css("background-color","black")}$("#cmc-search-icon").click(function(){$("#cmc-search-box").children("ul").children("li.bit-input").children(".maininput").focus()});$("#cmc-search-results-pagingctl-prev").button({text:false,icons:{primary:"ui-icon-circle-triangle-w"}}).click(function(){if(!$(this).button("option","disabled")){CMC.navigateToPreviousSearchPage()}});$("#cmc-search-results-pagingctl-next").button({text:false,icons:{primary:"ui-icon-circle-triangle-e"}}).click(function(){if(!$(this).button("option","disabled")){CMC.navigateToNextSearchPage()}});$("#cmc-search-results-title").hide();$("#cmc-search-results-noresultmsg").hide();$(".cmc-search-result").click(function(){CMC.handleSearchResultSelected(this)}).each(function(){$(this).hide()});$(".result-picture img").remove();CMC.checkFacebookLoginStatus(function(b){if(b.authResponse){CMC.loggedInUserID=b.authResponse.userID;CMC.cacheFacebookData(!CMC.linkProfileID,function(){if(CMC.linkTripID){CMC.getTripProfile(CMC.linkTripID)}else{CMC.getFutureTrips()}if(CMC.linkProfileID){CMC.getProfile(CMC.linkProfileID,true,CMC.handleGetProfileCallbackSaveAndShow)}else{if(CMC.profiledata){CMC.showProfile(CMC.profiledata)}else{}}})}else{CMC.handleUserUnauthorized()}});$("#copyrights-dialog").dialog({autoOpen:false,draggable:false,position:[227,50],resizable:false,title:"Christian Missions Connector v"+CMC.version,open:function(){CMC.dialogOpen(this)},close:function(){CMC.dialogClose(this)}});$("#copyrights").click(function(){$("#copyrights-dialog").dialog("open")});$("#report-problem-dialog").dialog({autoOpen:false,draggable:false,position:[177,90],resizable:false,width:400,open:function(){CMC.dialogOpen(this)},close:function(){CMC.dialogClose(this);if($("#report-problem-message").val().length<=0&&!$.browser.webkit){$("#report-problem-characters-left").hide()}}});$("#report-problem").click(function(){$("#report-problem-dialog").dialog("open")});$("#report-problem-submit").button().click(function(){void false});if(!$.browser.webkit){$("#report-problem-characters-left").hide()}$("#report-problem-message").click(function(){CMC.recalculateProblemMessageLimit()}).focus(function(){CMC.recalculateProblemMessageLimit()}).keyup(function(){CMC.recalculateProblemMessageLimit()}).keypress(function(){CMC.recalculateProblemMessageLimit()});$("#profile-submit").click(function(){CMC.submitProfile(CMC.getFormData("#profile-volunteer-form"))});$("#profile-org-submit").click(function(){CMC.submitorgProfile(CMC.getFormData("#profile-organizer-form"))});$("#profile-trip-submit").click(function(){CMC.submitTripProfile(CMC.getFormData("#profile-trip-form"))});$("#profile-trip-medical-skills").multiselect();$("#profile-trip-nonmedical-skills").multiselect();$("#profile-trip-spiritual-skills").multiselect();$("#profile-medical-skills").multiselect();$("#profile-nonmedical-skills").multiselect();$("#profile-spiritual-skills").multiselect();$("#profile-region").multiselect();$("#profile-country-served").multiselect();$("#profile-org-offer").multiselect();$("#profile-org-offern").multiselect();$("#profile-org-medical").multiselect();$("#profile-org-nonmedical").multiselect();$("#profile-org-spiritual").multiselect();$("#profile-org-region").multiselect();$("#profile-org-countryserved").multiselect();$("#profile-trip-name").validate({expression:"if (VAL) return true; else return false;",message:"Trip name is a required field"});$("#profile-org-website").validate({expression:"if (VAL.test(/(ftp|http|https)://(w+:{0,1}w*@)?(S+)(:[0-9]+)?(/|/([w#!:.?+=&%@!-/]))?/) && VAL) return true; else if (!VAL) return true; else return false;",message:"Please enter a valid website"});$("#profile-email").validate({expression:"if (VAL.match(/^[^\\W][a-zA-Z0-9\\_\\-\\.]+([a-zA-Z0-9\\_\\-\\.]+)*\\@[a-zA-Z0-9_]+(\\.[a-zA-Z0-9_]+)*\\.[a-zA-Z]{2,4}$/) && VAL) return true; else if (!VAL) return true; else return false;",message:"Please enter a valid Email ID"});$("#profile-org-email").validate({expression:"if (VAL.match(/^[^\\W][a-zA-Z0-9\\_\\-\\.]+([a-zA-Z0-9\\_\\-\\.]+)*\\@[a-zA-Z0-9_]+(\\.[a-zA-Z0-9_]+)*\\.[a-zA-Z]{2,4}$/) && VAL) return true; else if (!VAL) return true; else return false;",message:"Please enter a valid Email ID"});$("#profile-trip-email").validate({expression:"if (VAL.match(/^[^\\W][a-zA-Z0-9\\_\\-\\.]+([a-zA-Z0-9\\_\\-\\.]+)*\\@[a-zA-Z0-9_]+(\\.[a-zA-Z0-9_]+)*\\.[a-zA-Z]{2,4}$/) && VAL) return true; else if (!VAL) return true; else return false;",message:"Please enter a valid Email ID"});$("#profile-zipcode").validate({expression:"if (VAL.match(new RegExp(/(^[0-9]{5}$)|(^[0-9]{5}-[0-9]{4}$)/)) && VAL) return true; else if (!VAL) return true; else return false;",message:"Please enter a valid Zipcode"});$("#profile-org-zipcode").validate({expression:"if (VAL.match(new RegExp(/(^[0-9]{5}$)|(^[0-9]{5}-[0-9]{4}$)/)) && VAL) return true; else if (!VAL) return true; else return false;",message:"Please enter a valid Zipcode"});$("#profile-trip-zipcode").validate({expression:"if (VAL.match(new RegExp(/(^[0-9]{5}$)|(^[0-9]{5}-[0-9]{4}$)/)) && VAL) return true; else if (!VAL) return true; else return false;",message:"Please enter a valid Zipcode"});$("#profile-phone").validate({expression:"if (VAL.match(new RegExp(/(^[0-9]{10}$)/)) && VAL) return true; else if (!VAL) return true; else return false;",message:"Please enter a valid Phone Number: For Example: 1234567899"});$("#profile-org-phone").validate({expression:"if (VAL.match(new RegExp(/(^[0-9]{10}$)/)) && VAL) return true; else if (!VAL) return true; else return false;",message:"Please enter a valid Phone Number"});$("#profile-trip-phone").validate({expression:"if (VAL.match(new RegExp(/(^[0-9]{10}$)/)) && VAL) return true; else if (!VAL) return true; else return false;",message:"Please enter a valid Phone Number"});$(".profile-ddl-contents").css("display","none");$(".profile-ddl-type-country").css("display","United States");$(".profile-ddl-header").toggle(function(){a($(this).parent().find(".profile-ddl-contents"))},function(){a($(this).parent().find(".profile-ddl-contents"))});function a(b){$(".profile-ddl-contents").css("display","none");if(b.css("display")=="none"){b.fadeIn("slow")}else{b.fadeOut("slow")}}$(".profile-ddl-contents a").click(function(){$(this).parent().parent().find(".profile-ddl-o select").attr("selectedIndex",$(".profile-ddl-contents a").index(this));$(this).parent().parent().find(".profile-ddl-title").html($(this).html());$(this).parent().parent().find(".profile-ddl-contents").fadeOut("slow")});$("#loading").fadeOut(function(){$("#tabs").hide().fadeIn(function(){$("#cmc-footer").hide().delay(150).fadeIn()})})});